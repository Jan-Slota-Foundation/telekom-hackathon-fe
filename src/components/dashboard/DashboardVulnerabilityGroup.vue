<script setup>
import { vulnerabilityStore } from '@/store/vulnerabilityStore.js'
</script>
<template>
  <li
    @click="handleSelectVulnerability"
    :class="[
      'bg-slate-800 px-3 py-1 rounded-lg ',
      vulnerabilityStore.selectedVulnerability.name === categoryName
        ? 'border border-slate-500'
        : 'border-transparent border'
    ]"
  >
    <div class="flex justify-between items-center gap-4">
      <span class="text-sm truncate max-w-48">
        {{ categoryName }}
      </span>

      <!-- make a for loop out of this for every category -->
      <div class="flex gap-2">
        <AppSeverityChip
          v-for="(severityCategory, key) in vulnerabilitiesByCategory"
          :key="key"
          :status="key"
          :count="severityCategory"
        />
      </div>
    </div>
  </li>
</template>

<script>
import AppSeverityChip from '../AppSeverityChip.vue'
import DashboardVulnerabilityItem from './DashboardVulnerabilityItem.vue'
export default {
  name: 'DashboardVulnerabilityGroup',

  components: {
    DashboardVulnerabilityItem,
    AppSeverityChip
  },

  props: {
    categoryName: {
      type: String,
      required: true
    },

    vulnerabilities: {
      type: Array,
      required: true
    }
  },

  computed: {
    vulnerabilitiesByCategory() {
      let final = {
        critical: 0,
        high: 0,
        medium: 0,
        low: 0,
        unknown: 0
      }

      this.vulnerabilities.forEach((element) => {
        final[element.Severity]++
      })

      final = Object.fromEntries(
        Object.entries(final).filter(([key, value]) => value > 0)
      )
      return final
    }
  },

  methods: {
    handleSelectVulnerability() {
      vulnerabilityStore.selectedVulnerability = {
        name: this.categoryName,
        items: this.vulnerabilities
      }
    }
  }
}
</script>
