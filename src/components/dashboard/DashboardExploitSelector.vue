<template>
  <div class="max-w-[25rem]">
    <h3 class="text-center text-lg mb-4 text-primary-600 font-medium">
      Input Vulnerabilities
    </h3>
    <ul class="flex flex-col gap-2 overflow-y-scroll h-[40rem]">
      <DashboardVulnerabilityGroup
        v-for="(vulnerabilityCategory, index) in vulnerableGroups"
        :key="index"
        :categoryName="vulnerabilityCategory.category"
        :vulnerabilities="vulnerabilityCategory.items"
      />
    </ul>
  </div>
</template>

<script>
import DashboardVulnerabilityGroup from './DashboardVulnerabilityGroup.vue'
import DashboardVulnerabilityItem from './DashboardVulnerabilityItem.vue'
import { vulnerabilityStore } from '@/store/vulnerabilityStore.js'
import API from '@/api/axiosInstance.js'

export default {
  name: 'DashboardExploitSelector',

  components: {
    DashboardVulnerabilityItem,
    DashboardVulnerabilityGroup
  },

  async mounted() {
    console.log('moutned')
    setTimeout(() => {
      this.getVulnerabilities()
    }, 4000)
  },

  data() {
    return {
      vulnerabilities: null
    }
  },

  computed: {
    vulnerableGroups() {
      let groups = []
      if (this.vulnerabilities) {
        for (let key in this.vulnerabilities) {
          if (this.vulnerabilities.hasOwnProperty(key)) {
            groups.push({
              category: key,
              items: this.vulnerabilities[key]
            })
          }
        }
      }
      return groups
    }
  },

  methods: {
    async getVulnerabilities() {
      console.log('getVulnerabilities')
      try {
        let response = await API.get('/results')
        this.vulnerabilities = response.data
        console.log(this.vulnerabilities)
        vulnerabilityStore.isLoaded = true
      } catch (error) {
        console.log(error)
      }
    }
  }
}
</script>
